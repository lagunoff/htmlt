#!/usr/bin/env sh

DIR="$(dirname "${BASH_SOURCE[0]}")"
OUT_ARGS="-outputdir=$DIR/../out"
make --silent -f $DIR/envrc.mk $DIR/../.ghcjs.envrc || exit 1;
source $DIR/../.ghcjs.envrc
CABAL_ARGS=$(cd $DIR/../; cabal-cargs || exit 1)
CABAL_ARGS_GHCJS=$(echo $CABAL_ARGS | sed 's/-package=\(jsaddle-warp\|tagsoup\|aeson\|lens-regex\|regex-tdfa\|tagsoup-lens\|warp\|wai\|wai-app-static\|wai-extra\|jsaddle-warp\|wreq\)//g' | sed 's/-isrc-ghc//g'|| exit 1)

ghcjs -isrc-ghcjs $CABAL_ARGS_GHCJS $OUT_ARGS $@
